<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>White Tee & Jeans — Who Am I?</title>
<style>
  :root { --bg:#0b0c10; --card:#161b22; --ink:#e6f1ff; --muted:#9fb3c8; --accent:#2563eb; }
  body { margin:0; font-family: system-ui, -apple-system, Roboto, "Segoe UI", Arial; background:var(--bg); color:var(--ink); display:flex; min-height:100dvh; }
  .wrap { margin:auto; width:min(92vw,420px); display:flex; flex-direction:column; gap:14px; align-items:center; }
  h1 { font-size:20px; font-weight:700; margin:6px 0 2px; text-align:center; color:#e6f1ff; }
  .card { width:100%; border-radius:20px; background:var(--card); overflow:hidden; box-shadow:0 10px 24px rgba(0,0,0,.35); }
  .image { width:100%; aspect-ratio:3/4; background:#0e1116; object-fit:cover; display:block; }
  .meta { padding:14px 16px; }
  .name { font-size:20px; font-weight:700; margin:0 0 6px; }
  .context { font-size:14px; color:var(--muted); margin:0; }
  .row { display:flex; gap:10px; margin-top:6px; }
  button { appearance:none; border:0; border-radius:999px; padding:12px 18px; font-weight:700; color:white; background:var(--accent); cursor:pointer; }
  .muted { color:#7d8ea3; font-size:12px; text-align:center; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>I am:</h1>

    <div class="card" id="card">
      <img id="img" alt="Card image" class="image" />
      <div class="meta">
        <p class="name" id="name"></p>
        <p class="context" id="context"></p>
      </div>
    </div>

    <div class="row">
      <button id="shuffle">Shuffle</button>
    </div>

    <p class="muted">Tip: use your own licensed images. Works offline once images are cached.</p>
  </div>

<script>
const els = {
  img: document.getElementById("img"),
  name: document.getElementById("name"),
  context: document.getElementById("context"),
  shuffle: document.getElementById("shuffle"),
  card: document.getElementById("card"),
  status: document.getElementById("status"),
};

let CARDS = [];
let bag = [];

function reshuffleBag() {
  bag = CARDS.map((_, i) => i);
  for (let i = bag.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [bag[i], bag[j]] = [bag[j], bag[i]];
  }
}
function nextIndex() {
  if (bag.length === 0) reshuffleBag();
  return bag.pop();
}
function show(idx) {
  const c = CARDS[idx];
  els.img.src = c.imageUrl;
  els.img.alt = `${c.name} — ${c.context}`;
  els.name.textContent = c.name;
  els.context.textContent = c.context;
  els.card.hidden = false;
  els.shuffle.disabled = false;
  els.status.textContent = "Tap Shuffle to switch personas.";
}
function pickAndShow() {
  if (!CARDS.length) return;
  show(nextIndex());
}

async function loadCards() {
  try {
    // cache-bust to avoid stale CDN/browser cache
    const res = await fetch(`data/cards.json?v=${Date.now()}`, { cache: "no-store" });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    CARDS = Array.isArray(data.cards) ? data.cards : [];
    if (CARDS.length === 0) {
      els.status.textContent = "No cards yet. Add some in /admin.";
      return;
    }
    reshuffleBag();
    pickAndShow();
  } catch (e) {
    els.status.textContent = "Failed to load deck. Check data/cards.json";
  }
}

els.shuffle.addEventListener("click", pickAndShow);
loadCards();
</script>

</body>
</html>
